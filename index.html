<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ØªØ­Ø¯ÙŠ Ø§Ù„Ù‚Ù…Ø© - LIVE</title>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root { --primary: #6c5ce7; --secondary: #00cec9; --bg: #0f172a; }
        * { font-family: 'Tajawal', sans-serif; box-sizing: border-box; }
        body { background: var(--bg); color: white; display: flex; justify-content: center; align-items: center; min-height: 100vh; margin: 0; overflow: hidden; }
        .card { background: rgba(255, 255, 255, 0.05); backdrop-filter: blur(15px); padding: 30px; border-radius: 24px; width: 95%; max-width: 500px; text-align: center; border: 1px solid rgba(255,255,255,0.1); position: relative; }
        h1 { font-size: 1.4rem; margin-bottom: 10px; }
        .arena { position: relative; height: 80px; margin: 30px 0; background: rgba(255,255,255,0.02); border-radius: 40px; display: flex; align-items: center; border: 1px solid rgba(255,255,255,0.1); }
        .rope { width: 85%; height: 4px; background: rgba(255,255,255,0.1); margin: 0 auto; position: relative; }
        #puck { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 45px; height: 45px; background: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; transition: all 1s cubic-bezier(0.4, 0, 0.2, 1); font-size: 22px; box-shadow: 0 0 15px rgba(108, 92, 231, 0.5); z-index: 10; }
        .stats { display: flex; justify-content: space-between; gap: 15px; }
        .player-info { background: rgba(255,255,255,0.05); padding: 15px; border-radius: 16px; width: 50%; transition: all 0.3s; }
        .player-info.active { background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); }
        .val { font-size: 24px; font-weight: bold; display: block; margin-top: 5px; }
        #game-over { display: none; position: absolute; inset: 0; background: rgba(15, 23, 42, 0.98); z-index: 100; border-radius: 24px; align-items: center; justify-content: center; flex-direction: column; border: 2px solid var(--primary); }
        .loader { font-size: 10px; color: #64748b; margin-top: 10px; }
    </style>
</head>
<body>

<div class="card">
    <div id="game-over">
        <h1 id="winner-name" style="font-size: 2rem; color: #fbbf24;">GAME OVER</h1>
        <p id="winner-sub" style="margin-bottom: 20px;"></p>
        <button onclick="location.reload()" style="padding:10px 25px; background: var(--primary); border:none; color:white; border-radius:8px; cursor:pointer; font-weight:bold;">Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø©</button>
    </div>

    <h1>âš”ï¸ ØªØ­Ø¯ÙŠ Ø§Ù„Ù‚Ø±Ø§ÙŠØ© âš”ï¸</h1>
    <div id="loading-text" class="loader">Ø¬Ø§Ø±ÙŠ Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø© Ù…Ø¹ Google Sheets...</div>

    <div class="arena">
        <div class="rope">
            <div id="puck">âš–ï¸</div>
        </div>
    </div>

    <div class="stats">
        <div class="player-info" style="border-bottom: 4px solid var(--primary);">
            <small style="color:var(--primary)">Ø£Ù†Øª (11 Øµ)</small>
            <span id="myP" class="val">0%</span>
        </div>
        <div class="player-info" style="border-bottom: 4px solid var(--secondary);">
            <small style="color:var(--secondary)">ØµØ¯ÙŠÙ‚Ùƒ (7 Øµ)</small>
            <span id="frP" class="val">0%</span>
        </div>
    </div>
</div>

<script>
    // Ø±Ø§Ø¨Ø· Ù…Ù„ÙÙƒ Ù…Ø­ÙˆÙ„ Ø¨ØµÙŠØºØ© CSV Ù„Ù„Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ù„Ø­Ø¸ÙŠØ©
    const SHEET_CSV = "https://docs.google.com/spreadsheets/d/e/2PACX-1vRmFvp4wwoxQ23JQG6aeP-T-mg2rtkeoOkJHYgV9v2cMS_RFs2khMGGOSlV7d12uw1QwojiW5CQFDCY/pub?output=csv";

    async function fetchData() {
        try {
            // Ø¥Ø¶Ø§ÙØ© timestamp Ù„Ù…Ù†Ø¹ Ø§Ù„Ù…ØªØµÙØ­ Ù…Ù† ØªØ®Ø²ÙŠÙ† Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø© (Cache)
            const response = await fetch(SHEET_CSV + "&t=" + new Date().getTime());
            const data = await response.text();
            
            // ØªÙ‚Ø³ÙŠÙ… Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª (Ù†ÙØªØ±Ø¶ Ø£Ù† Ø§Ù„ØµÙ Ø§Ù„Ø£ÙˆÙ„ Ø¹Ù†Ø§ÙˆÙŠÙ† ÙˆØ§Ù„ØµÙ Ø§Ù„Ø«Ø§Ù†ÙŠ Ù‡Ùˆ Ø§Ù„Ø£Ø±Ù‚Ø§Ù…)
            const rows = data.split('\n');
            if(rows.length < 2) return;
            
            const values = rows[1].split(',');
            const myDone = parseFloat(values[0]) || 0;
            const frDone = parseFloat(values[1]) || 0;
            
            updateUI(myDone, frDone);
            document.getElementById('loading-text').innerText = "Ù…ØªØµÙ„ ÙˆÙ…Ø²Ø§Ù…Ù† âœ…";
        } catch (e) {
            document.getElementById('loading-text').innerText = "Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ âŒ";
        }
    }

    function updateUI(myD, frD) {
        const myTotal = 11; 
        const frTotal = 7;

        const myPercent = Math.min(Math.round((myD / myTotal) * 100), 100);
        const frPercent = Math.min(Math.round((frD / frTotal) * 100), 100);

        document.getElementById('myP').innerText = myPercent + "%";
        document.getElementById('frP').innerText = frPercent + "%";

        // Ø­Ø³Ø§Ø¨ Ø­Ø±ÙƒØ© Ø§Ù„Ø­Ø¨Ù„ (0% Ù„Ù„ÙŠØ³Ø§Ø±ØŒ 100% Ù„Ù„ÙŠÙ…ÙŠÙ†ØŒ 50% ÙˆØ³Ø·)
        // Ø¥Ø°Ø§ Ø²Ø§Ø¯Øª Ù†Ø³Ø¨Ø© ØµØ¯ÙŠÙ‚Ùƒ ÙŠÙ†Ø³Ø­Ø¨ Ø§Ù„Ø­Ø¨Ù„ Ù„Ø¬Ù‡ØªÙ‡
        let diff = frPercent - myPercent;
        let move = 50 + (diff / 2);
        
        if (move < 5) move = 5;
        if (move > 95) move = 95;

        const puck = document.getElementById('puck');
        puck.style.left = move + "%";

        // ØªØºÙŠÙŠØ± Ø§Ù„Ø±Ù…ÙˆØ²
        if (myPercent > frPercent) puck.innerText = "ğŸ’ª";
        else if (frPercent > myPercent) puck.innerText = "ğŸƒâ€â™‚ï¸";
        else puck.innerText = "âš–ï¸";

        // Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ù„Ø¹Ø¨Ø©
        if (myPercent >= 100 || frPercent >= 100) {
            document.getElementById('game-over').style.display = 'flex';
            const winSub = document.getElementById('winner-sub');
            if (myPercent >= 100 && frPercent >= 100) {
                winSub.innerText = "ØªØ¹Ø§Ø¯Ù„! ÙƒÙ…Ù„ØªÙˆØ§ ÙÙŠ Ø²ÙˆØ¬ Ø£Ø¨Ø·Ø§Ù„!";
            } else if (myPercent >= 100) {
                winSub.innerText = "ğŸ† Ù…Ø¨Ø±ÙˆÙƒ! Ù„Ù‚Ø¯ Ø³Ø­Ù‚Øª Ø§Ù„Ù…Ù†Ø§ÙØ³!";
            } else {
                winSub.innerText = "ğŸ’€ Ù‡Ø§Ø±Ø¯ Ù„Ùƒ! ØµØ§Ø­Ø¨Ùƒ ÙƒÙ…Ù„ Ù‚Ø¨Ù„Ùƒ!";
            }
        }
    }

    // Ø§Ù„ØªØ­Ø¯ÙŠØ« ÙƒÙ„ 3 Ø«ÙˆØ§Ù†Ù Ù„Ø¶Ù…Ø§Ù† Ø§Ù„Ø³Ø±Ø¹Ø©
    setInterval(fetchData, 3000);
    fetchData(); // ØªØ´ØºÙŠÙ„ Ø£ÙˆÙ„ÙŠ
</script>

</body>
</html>
